<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="icon" type="image/png" href="https://kkkkame0721.github.io/demoApp/icon/icon-192.png">
<link rel="apple-touch-icon" type="image/png" href="https://kkkkame0721.github.io/demoApp/icon/icon-180.png">
<meta charset="UTF-8">
<meta name="viewport" content="
  width=device-width,
  initial-scale=1,
  maximum-scale=1,
  minimum-scale=1,
  viewport-fit=cover
">

<title>未来型半券サービスAkashic</title>
<style>
  :root {
    --titlebar-height: 60px;
    --tabbar-height: calc(60px + env(safe-area-inset-bottom));
    --main-gradation: linear-gradient(to right, #FF54AF, #FF9A0B);
  }
  
  html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    color: #333333;
    font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans",
               "Noto Sans JP", "Meiryo", sans-serif;
  }
  
  /* ロード画面 */
  .load {
    width: 100%;
    height: 100%;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
    background: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 10px;
    opacity: 1;
  }
  .load.hidden {
    transition: opacity 0.3s ease;
    opacity: 0;
    pointer-events: none;
  }
  
  .load #loadImageContainer {
    width: 20%;
    aspect-ratio: 1;
  }
  
  .load img {
  }
  #lineContainer {
    height: 14px;
    width: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #loadingLine {
    height: 10px;
    width: 90%;
    border-radius: 10px;
    animation: skelton-loading 1.5s ease-in-out infinite;
  }
  @keyframes skelton-loading {
    0%   { background-color: #FF54AF; transform: scaleX(0.2); }
    100% { background-color: #FF9A0B; transform: scaleX(1); height: 5px;}
  }

  .page {
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    transform: translateX(100%);
    transition: transform 0.4s ease;
    opacity: 0;
  }
  /* アクティブなページは中央に */
  .page.active {
    transform: translateX(0);
    opacity: 1;
  }
  .page.left {
    transform: translateX(-100%);
    opacity: 1;
  }
  .page.right {
    transform: translateX(100%);
    opacity: 1;
  }
  
  .page#ticket {
    position: relative;
  }
  
  /* ページ内容はタイトルバーの下から始まるように */
  .page-content {
    box-sizing: border-box;
    padding-top: var(--titlebar-height);
    padding-bottom: var(--tabbar-height);
  }
  
  .page-content img{
    width: 100%;
  }
  
  /* --- ホームタブ関連 --- */
  /* ホーム用コンテナ */
  #homeContainer {
    padding: 12px;
    padding-bottom: calc(var(--tabbar-height) + 70px);
    display: flex;
    flex-direction: column;
  }

  /* セクション共通 */
  .section {
    display: flex;
    flex-direction: column;
  }

  .section-title {
    margin: 0;
    margin-bottom: 0.5rem;
    width: fit-content;
    background: var(--main-gradation);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  /* 「運営からのお知らせ」 */
  .notice-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    border: #ccc solid 1px;
    border-radius: 8px;
    padding: 12px;
    margin: 0;
    margin-bottom: 24px;
  }

  .notice-item {
    display: flex;
    flex-direction: column;
    font-size: 14px;
    color: #333;
    padding: 12px 14px;
    border-radius: 8px;
    border: 1px solid #e5e5e5;
    background: #fcfcfc;
  }

  .notice-item .date {
    font-size: 12px;
    color: #888;
  }

  /* あなたへのオススメ */
  .tag-block {
    padding: 0 12px;
    display: flex;
    flex-direction: column;
    border: #ccc solid 1px;
    border-radius: 8px;
    margin-bottom: 24px;
  }

  .tag-title {
    font-size: 14px;
    color: #666;
  }
  .tag-title span {
    border-bottom: #ccc solid 1px;
  }

  /* チケット/展示/ライブ項目 */
  .item-list {
    display: flex;
    flex-direction: column;
    gap: 14px;
    padding: 0;
  }

  .item-card {
    padding: 12px 14px;
    border-radius: 8px;
    border: 1px solid #e5e5e5;
    background: #fcfcfc;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .item-title {
    font-size: 15px;
    font-weight: 600;
    color: #222;
  }

  .item-info {
    display: flex;
    gap: 12px;
    font-size: 13px;
    color: #555;
  }

  
  /* --- チケットタブ関連 --- */
  .ticket-tabs {
    display: flex;
    border-bottom: 1px solid #ddd;
    padding: 10px 12px;
    gap: 8px;
    position: sticky;
    top: var(--titlebar-height);
    background: white;
  }

  .ticket-tabs .tab-btn {
    flex: 1;
    padding: 12px;
    border-radius: 160px;
    text-align: center;
    background: #f5f5f5;
    color: #333333;
    border: none;
    font-size: 16px;
  }

  .ticket-tabs .tab-btn.active {
    background: var(--main-gradation);
    color: white;
  }
  
  .ticket-list {
    display: none;
    padding: 12px;
  }

  .ticket-list.active {
    display: block;
  }

  .ticket-card {
    background: white;
    padding: 12px;
    border-radius: 3px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
  }
  
  /* --- チケット詳細パネル --- */
  #ticket-detail-panel {
    position: absolute;
    top: var(--titlebar-height);
    bottom: var(--tabbar-height);
    left: 0;
    width: 100%;
    background: #fff;
    z-index: 50;

    transform: translateX(100%);
    transition: transform 0.35s ease;
    overflow-y: auto;
  }

  /* パネルを表示時 */
  #ticket-detail-panel.active {
    transform: translateX(0);
  }

  /* 上部 */
  .detail-header {
    position: sticky;
    top: 0;
    background: white;
    padding: 12px;
    border-bottom: 1px solid #ddd;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  #detail-back-btn, #stub-back-btn {
    font-size: 18px;
    background: transparent;
    color: #333;
    border: none;
  }
  
  /* 詳細パネル中部 */
  .detail-body {
    padding: 0 12px;
  }
  
  /* 入場アニメーション */
  .animationContainer {
    display: flex;
    justify-content: center;
  }
  .ticket-animation {
    height: calc(100dvh - var(--tabbar-height) - var(--titlebar-height));
    position: absolute;
    top: 0;
    z-index: 100;
    display: none;
  }
  .ticket-animation.active {
    display: block;
  }

  /* 半券画像 */
  #stub-image {
    width: 80%;
    margin-bottom: 16px;
  }

  /* ボタン */
  .stub-actions {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    pointer-events: none;
  }

  /* 汎用アクションボタン */
  .action-btn {
    padding: 12px;
    border-radius: 100px;
    background: var(--main-gradation);
    color: white;
    border: none;
    font-size: 14px;
    display: block;
    width: 40vw;
    margin: 0 auto;
    margin-top: 12px;
    cursor: pointer;
  }
  
  .action-btn.inactive {
    background: #D0D0D0;
    pointer-events: none;
  }

  
  /* --- 上部タイトルバー --- */
  .title-bar {
    position: fixed;
    justify-content: center;
    top: 0;
    left: 0;
    width: 100%;
    height: var(--titlebar-height);
    background: #fff;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    padding: 0 1rem;
    box-sizing: border-box;
    z-index: 70;
  }
  .title-bar.hidden {
    display: none;
  }

  /* メニューアイコン */
  .menu-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    width: 24px;
    height: 24px;
    margin-right: 1rem;
    cursor: pointer;
  }

  /* タイトル文字 */
  .page-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: #333333;
    margin: 0;
  }

  
  /* ホーム画面下部の画像 */
  .home-bottom {
    position: fixed;
    bottom: 70px;
    left: 0;
    width: 100%;
    z-index: 850;
    padding: 0 16px;
    box-sizing: border-box;
    transition: opacity 150ms ease;
  }
  .home-bottom img {
    max-width: 100%;
    height: auto;
  }
  .home-bottom #homeBottomToTicket {
    cursor: pointer;
  }

  /* 縦画面動画 */
  .card {
    position: relative;
    height: 100%;
    width: 100%;
    scroll-snap-align: start;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2rem;
    transition: transform 0.4s ease, opacity 0.4s ease;
    background: #2b2e4a;
  }

  .card:not(.active) {
    transform: scale(0.95);
    opacity: 0.7;
  }
  
  /* 縦動画 */
  .card .card-video {
    max-width: calc(100% - 6px);
    margin-bottom: 20px;
  }
  
  /* 動画下部の情報欄 */
  .info {
    position: absolute;
    bottom: calc(var(--tabbar-height, 60px) + 16px);
    left: 16px;
    font-size: 1.1rem;
    text-shadow: 0 0 8px rgba(0,0,0,0.6);
  }

  /* モーダルの基本構造 */
  .modal {
    position: fixed;
    top: 0;
    right: -96%;
    width: 100%;
    height: 94dvh;
    background: white;
    color: #333;
    transition: right 0.4s ease;
    z-index: 10;
    border-top-left-radius: 16px;
    border-bottom-left-radius: 16px;
    overflow: hidden;
    box-shadow: -4px 0 10px rgba(0,0,0,0.2);
  }
  /* はみ出してる部分 */
  .modal #modal-swipe-handle {
    position: absolute;
    top: 0;
    left: 0;
    width: 16px;
    height: 100%;
    cursor: pointer;
    /* デバッグ中だけ色をつける（完成時は消す） */
    /*background: rgba(255,0,0,0.2);*/
  }
  
  .modal.hidden {
    display: none;
  }

  .modal.open {
    right: 0;
  }
  
  .modal-content {
    padding-left: 16px;
    padding-right: 8px;
    height: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  #eventImage {
    max-width: 100%;
    display: block;
    margin: 0 auto;
  }
  
  .modal-hero {
    width: 60%;
    margin: 0 auto;
    margin-bottom: 20px;
    display: flex;
    justify-content: center;
  }

  .modal-hero img {
    max-height: 180px;
    height: auto;
    object-fit: contain;
    display: block;
  }


  .modal-header {
    padding: 1rem;
    background: white;
    font-size: 1.2rem;
  }

  .close-btn {
    color: #333;
    float: right;
    font-size: 1.2rem;
    cursor: pointer;
  }
  
  /* コレクションページ */
  .collection-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px 5px;
    padding: 5px;
  }
  .collection-grid img {
    width: 100%;
    border-radius: 4px;
    cursor: pointer;
  }

  /* 戻るボタン */
  .back-btn {
    position: fixed;
    top: 16px;
    left: 16px;
    background: rgba(0,0,0,0);
    color: white;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    font-size: 1.2rem;
    z-index: 20;
    cursor: pointer;
    display: none;
  }
  
  .back-btn.active {
    display: block;
  } 
  
  /* --- ボトムタブバー --- */
  .tab-bar {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: var(--tabbar-height);
    background: #fff;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    z-index: 120;
  }

  .tab {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 33.3%;
    font-size: 0.7rem;
    color: #757575;
    cursor: pointer;
    padding-top: 0.2rem;
  }

  .tab img {
    width: 22px;
    height: 22px;
    margin-bottom: 2px;
  }

  .tab.active {
    font-weight: bold;
  }

  .tab.active span {
    background: var(--main-gradation);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  * {
    touch-action: pan-y; /* ← スマホで横スクロール無効化 */
  }
</style>
</head>
<body>
  <!-- ロード画面 -->
  <div class="load" id="load">
    <div id="loadImageContainer">
      <!-- <img src="https://kkkkame0721.github.io/demoApp/img/menu.svg"> -->
      <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDQyIDM3IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zOnNlcmlmPSJodHRwOi8vd3d3LnNlcmlmLmNvbS8iIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MjsiPgogICAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsMSwtMTA3NCwtNDkpIj4KICAgICAgICA8ZyB0cmFuc2Zvcm09Im1hdHJpeCgwLjMzMzMzMywwLDAsMC4zMzMzMzMsMTA2My42NiwwKSI+CiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0ibWF0cml4KDMuNTEzOTcsLTEuNTcyMjFlLTIwLC0xLjU4ODIzZS0yMCwzLjU1MDAyLC00NjM5LjM4LC0zNzYuMDk4KSI+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTM0Ny45NywxNzguMDc2TDEzMjkuODMsMTc4LjA3NkMxMzI5LjY4LDE3OC4wNzYgMTMyOS41MywxNzcuOTk1IDEzMjkuNDUsMTc3Ljg2MkMxMzI5LjM4LDE3Ny43MjkgMTMyOS4zOCwxNzcuNTY1IDEzMjkuNDUsMTc3LjQzMkwxMzQ2LjQsMTQ4LjM3NUMxMzQ2LjQ4LDE0OC4yNDIgMTM0Ni42MiwxNDguMTYgMTM0Ni43OCwxNDguMTZDMTM0Ni45MywxNDguMTYgMTM0Ny4wOCwxNDguMjQyIDEzNDcuMTUsMTQ4LjM3NUwxMzY0LjEsMTc3LjQzMkMxMzY0LjE4LDE3Ny41NjUgMTM2NC4xOCwxNzcuNzI5IDEzNjQuMSwxNzcuODYyQzEzNjQuMDIsMTc3Ljk5NSAxMzYzLjg4LDE3OC4wNzYgMTM2My43MywxNzguMDc2TDEzNTkuMjMsMTc4LjA3NkwxMzUzLjYsMTY4LjQyNEwxMzQ3Ljk3LDE3OC4wNzZaIiBzdHlsZT0iZmlsbDp1cmwoI19MaW5lYXIxKTsiLz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KICAgIDxkZWZzPgogICAgICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iX0xpbmVhcjEiIHgxPSIwIiB5MT0iMCIgeDI9IjEiIHkyPSIwIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgzNC43NjMxLDEuMzAzNDRlLTEzLC0xLjE0NDg1ZS0xMywyOS45MTY0LDEzMjkuNCwxNzguMDc2KSI+PHN0b3Agb2Zmc2V0PSIwIiBzdHlsZT0ic3RvcC1jb2xvcjpyZ2IoMjU1LDEwMCwxNzMpO3N0b3Atb3BhY2l0eToxIi8+PHN0b3Agb2Zmc2V0PSIwLjUiIHN0eWxlPSJzdG9wLWNvbG9yOnJnYigyNTUsMTA0LDk0KTtzdG9wLW9wYWNpdHk6MSIvPjxzdG9wIG9mZnNldD0iMSIgc3R5bGU9InN0b3AtY29sb3I6cmdiKDI1NSwxNjAsNjApO3N0b3Atb3BhY2l0eToxIi8+PC9saW5lYXJHcmFkaWVudD4KICAgIDwvZGVmcz4KPC9zdmc+Cg==">
    </div>
    <div id="lineContainer">
      <div id="loadingLine"></div>
    </div>

  </div>
  
  <!-- タイトルバー -->
  <div class="title-bar" id="titleBar">
    <img src="https://kkkkame0721.github.io/demoApp/img/menu.svg?ver=1.1" alt="menu" class="menu-icon" onclick=showPage('home') />
    <h1 class="page-title" id="pageTitle"></h1>
  </div>
  
  <!-- ホームタブ -->
  <div class="page" id="home" data-tabname="ホーム">
    <div class="page-content">
      <div id="homeContainer">
        <!-- 運営からのお知らせ -->
        <section class="section notice">
          <h2 class="section-title">運営からのお知らせ</h2>
          <ul class="notice-list">
            <li class="notice-item">
              <span class="date">2025/11/03</span>
              <span class="text">システムメンテナンス 2025/12/02(火)</span>
            </li>
            <li class="notice-item">
              <span class="date">2025/11/14</span>
              <span class="text">年始のアクセス集中により一時的に表示が遅くなる場合があります。</span>
            </li>
          </ul>
        </section>

        <!-- あなたへのオススメ -->
        <section class="section recommend">
          <h2 class="section-title">あなたへのオススメ</h2>

          <!-- #映画・#愛知県 -->
          <div class="tag-block">
            <h3 class="tag-title">フォロー中のタグ：<span>#映画</span></h3>
            <ul class="item-list">

              <li class="item-card">
                <div class="item-title">「偽者の庭」先行上映会</div>
                <div class="item-info">
                  <span class="date">2025/12/12</span>
                  <span class="place">ダミーシネマ名古屋</span>
                </div>
              </li>

              <li class="item-card">
                <div class="item-title">「嘘」舞台挨拶付き上映</div>
                <div class="item-info">
                  <span class="date">2026/01/08</span>
                  <span class="place">栄404シネマ</span>
                </div>
              </li>

            </ul>
          </div>

          <!-- #展覧会 -->
          <div class="tag-block">
            <h3 class="tag-title">フォロー中のタグ：<span>#展覧会</span></h3>
            <ul class="item-list">

              <li class="item-card">
                <div class="item-title">「色と欺瞞」現代美術展</div>
                <div class="item-info">
                  <span class="date">2025/12/20</span>
                  <span class="place">岐阜県虚構美術館</span>
                </div>
              </li>

            </ul>
          </div>

          <!-- #ライブ -->
          <div class="tag-block">
            <h3 class="tag-title">フォロー中のタグ：<span>#ライブ</span></h3>
            <ul class="item-list">

              <li class="item-card">
                <div class="item-title">DUMMY NIGHT TOUR 2025 TOKYO</div>
                <div class="item-info">
                  <span class="date">2025/12/27</span>
                  <span class="place">FAKE HALL SHIBUYA</span>
                </div>
              </li>

              <li class="item-card">
                <div class="item-title">嘘フェス 2026冬</div>
                <div class="item-info">
                  <span class="date">2026/01/11</span>
                  <span class="place">愛知国際ダミーホール</span>
                </div>
              </li>

            </ul>
          </div>

        </section>
        
      </div>
    </div>
  </div>

  <!-- ホームタブ下部の固定画像 -->
  <div class="home-bottom" id="homeBottom">
    <img src="https://kkkkame0721.github.io/demoApp/img/home_content_bottom_1.svg" id="homeBottomToTicket" />
    <img src="https://kkkkame0721.github.io/demoApp/img/home_content_bottom_2.svg" />
  </div>
  
  <!-- チケットタブ -->
  <div class="page" id="ticket" data-tabname="チケット管理">
    <div class="page-content">
      <!-- 開催前・開催済みタブ -->
      <div class="ticket-tabs">
        <button id="pre-list-btn" class="tab-btn active" data-target="pre-list">開催前チケット</button>
        <button class="tab-btn" data-target="post-list">開催済みチケット</button>
      </div>

      <!-- 開催前チケット -->
      <div id="pre-list" class="ticket-list active">
        <div class="ticket-card">
          <div class="ticket-title">DUMMY NIGHT TOUR 2025 NAGOYA</div>
          <div class="ticket-date">2025/11/14(金)</div>
        </div>

        <div class="ticket-card">
          <div class="ticket-title">ダミクエ リリース前特別体験会</div>
          <div class="ticket-date">2026/01/11(日)</div>
        </div>
      </div>

      <!-- 開催済みチケット -->
      <div id="post-list" class="ticket-list">
        <div class="ticket-card used">
          <div class="ticket-title">虚構博覧会「FAKE EXHIBITION 2025」</div>
          <div class="ticket-date">2025/11/05(水)</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- コレクションタブ -->
  <div class="page" id="collection" data-tabname="コレクション">
    <div class="page-content">
      <div class="collection-grid" id="collectionGrid">
      </div>
    </div>
  </div>
  
  <!-- 縦動画タブ -->
  <div class="page" id="scrollArea">
  </div>
  <button class="back-btn" id="backBtn">←</button>
  
  <!-- チケット詳細パネル -->
  <div id="ticket-detail-panel">
    <div class="detail-header">
      <button id="detail-back-btn">←</button>
      <span id="detail-title"></span>
    </div>
    <!-- 入場アニメーション -->
    <div class="animationContainer">
      <video class="ticket-animation" id="ticketAnimation" playsinline muted>
        <source src="https://kkkkame0721.github.io/demoApp/img/ticket_movie.mp4" type="video/mp4">
      </video>
    </div>
    <!-- ここに詳細情報が入る -->
    <div class="detail-body" id="detail-body">
    </div>
  </div>

  
  <!-- 詳細モーダル -->
  <div class="modal hidden" id="modal">
    <div id="modal-swipe-handle"></div>

    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title">詳細ページ</span>
        <span class="close-btn" id="closeModal">✕</span>
      </div>

      <div class="modal-body">

        <!-- ① 半券＋本券画像 -->
        <div class="modal-hero">
          <img id="modalHeroStubImage" />
          <img id="modalHeroTicketImage" />
        </div>

        <!-- ② イベント詳細セクション -->
        <section class="modal-section" id="eventSection">
          <h2 class="section-title">イベント詳細</h2>

          <div class="event-content">
            <img id="eventImage" src="https://placehold.jp/360x120.png">
            <div class="event-text">
              <h3 id="eventTitle">タイトル</h3>
              <p id="eventDate">日付</p>
            </div>
          </div>
        </section>

        <!-- ③ 詳細情報セクション -->
        <section class="modal-section" id="detailSection">
          <h2 class="section-title">詳細情報</h2>

          <p><strong>場所：</strong><span id="eventLocation">未設定</span></p>
          <p><strong>撮影日時：</strong><span id="eventRecordedAt">未設定</span></p>
          <p><strong>メモ：</strong><span id="eventNotes">未設定</span></p>
        </section>

      </div>
    </div>
  </div>



  <!-- ボトムバー -->
  <div class="tab-bar" id="tabBar">
    <div class="tab" data-tab="home">
      <img src="https://kkkkame0721.github.io/demoApp/icon/home.svg" alt="ホーム">
      <span>ホーム</span>
    </div>
    <div class="tab" data-tab="ticket">
      <img src="https://kkkkame0721.github.io/demoApp/icon/ticket.svg" alt="チケット">
      <span>チケット</span>
    </div>
    <div class="tab" data-tab="collection">
      <img src="https://kkkkame0721.github.io/demoApp/icon/collection.svg" alt="コレクション">
      <span>コレクション</span>
    </div>
  </div>

<script>
  const pages = document.querySelectorAll('.page');
  const cards = [];
  const details = [];
  const scrollArea = document.getElementById('scrollArea');
  const modal = document.getElementById('modal');
  const modalContent = document.getElementById('modalContent');
  const backBtn = document.getElementById('backBtn');
  const closeBtn = document.getElementById('closeModal');
  const tabs = document.querySelectorAll('.tab');
  const collectionGrid = document.getElementById('collectionGrid');
  const DEFAULT_PAGE = "home";
  let currentPage = document.getElementById(DEFAULT_PAGE);

  /* --- JSONデータ取得 → カード要素生成 --- */
  fetch('https://kkkkame0721.github.io/demoApp/data.json?ver='+Date.now())
    .then(res => res.json())
    .then(data => {
      data.forEach(item => {
        details.push(item);
        
        const card = document.createElement('div');
        card.classList.add('card');
        card.dataset.cardid = item.id;
        card.innerHTML = `
          <video class="card-video" id=${item.id} playsinline muted>
            <source src=${item.video+"?ver=1.1"} type="video/mp4">
          </video>
          <div class="info">
            ${item.title}
            <br>
            ${item.date}
          </div>
        `;
        // 再生が終わったら最初に戻す
        const v = card.querySelector(".card-video");
        v.addEventListener("ended", () => {
          animationReset(v);
        });
        
        scrollArea.appendChild(card);
        cards.push(card);
        
        // サムネイル設定
        const thumb = document.createElement('img');
        thumb.classList.add("thumbnail");
        thumb.src = item.thumbnail+"?ver=1.3";
        thumb.dataset.thumbid = item.id;
        
        // サムネイルクリック時の挙動を登録
        thumb.addEventListener("click", e => {
          const targetId = e.target.dataset.thumbid;
          const targetIndex = data.findIndex(item => item.id === targetId);

          // 全ての動画状況をリセットしてからscrollAreaへ遷移
          allCardVideoStop();
          showPage("scrollArea");

          // 遷移が終わった後にスクロール位置を調整し、再生
          requestAnimationFrame(() => {
            const height = window.innerHeight;
            scrollArea.scrollTop = targetIndex * height;
            playVideo(targetId);
          });
        });
        
        collectionGrid.appendChild(thumb);
        
        // 開催済みチケット生成
        const postList = document.getElementById("post-list");
        const usedCard = document.createElement("div");
        usedCard.classList.add("ticket-card", "used");
        usedCard.dataset.thumbid = item.id;
        usedCard.innerHTML = `
          <div class="ticket-title">${item.title}</div>
          <div class="ticket-date">${item.date}</div>
        `;
        postList.appendChild(usedCard);
      });
    })
  .then(init);
  
  /* --- 縦スクロールアニメーション制御 --- */
  function updateVideoPlayback() {
    const scrollPos = scrollArea.scrollTop;
    const height = window.innerHeight;

    cards.forEach((card, index) => {
      const video = card.querySelector(".card-video");
      const offset = Math.abs(scrollPos - index * height);
      const progress = Math.min(offset / height, 1);

      // スケール & 透明度
      card.style.transform = `scale(${1 - progress * 0.05})`;
      card.style.opacity = `${1 - progress * 0.3}`;

      // ★ 画面中央に一番近いカードだけ再生、それ以外停止
      if (offset < height * 0.4) {
        card.classList.add("active");
        if (video.paused) {
          video.play();
        }
      } else {
        card.classList.remove("active");
        animationReset(video);
      }
    });
  }

  /* --- スワイプ関連 --- */
  let startX = 0;
  scrollArea.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX;
  });
  scrollArea.addEventListener('touchend', e => {
    const endX = e.changedTouches[0].clientX;
    const diff = endX - startX;
    // 左スワイプ→詳細モーダル開く、右スワイプ→コレクションページに戻る
    if (startX > 300 && diff < -80) {
      openModal();
    } else if (startX < 100 && diff > 80) {
      showPage("collection");
    }
  });
  
  // モーダル内スワイプで閉じる
  let modalStartX = 0;
  modal.addEventListener('touchstart', e => modalStartX = e.touches[0].clientX);
  modal.addEventListener('touchend', e => {
    const modalDiff = e.changedTouches[0].clientX - modalStartX;
    if (modalStartX < 100 && modalDiff > 80) {
      closeModal();
    }
  });
  // ボタンでモーダルを閉じる
  closeBtn.addEventListener('click', closeModal);

  // モーダル内のデータを更新する関数
  function updateModalInner (data) {
    /*
      <div class="event-content">
        <img id="eventImage" src="https://placehold.jp/360x120.png" alt="event thumbnail">
        <div class="event-text">
          <h3 id="eventTitle">タイトルが入ります</h3>
          <p id="eventDate">日付が入ります</p>
        </div>
      </div>
     */
    const eventTitle = document.getElementById("eventTitle");
    const eventDate = document.getElementById("eventDate");
    const eventImage = document.getElementById("eventImage");
    const stubImage = document.getElementById("modalHeroStubImage");
    const ticketImage = document.getElementById("modalHeroTicketImage");
    eventTitle.textContent = data.title;
    eventDate.textContent = data.date;
    eventImage.src = data.eventimage;
    stubImage.src = data.thumbnail;
    ticketImage.src = data.ticketimage;
  }
  // モーダルを開く関数
  function openModal() {
    const activeCardId = document.querySelector('.card.active').dataset.cardid;
    const cardIdList = Array.from(cards).map(c => c.dataset.cardid);
    const index = cardIdList.indexOf(activeCardId);
    // モーダル内のデータを更新
    updateModalInner(details[index]);
    
    modal.classList.add('open');
    backBtn.classList.remove("active");
  }
  // モーダルを閉じる関数
  function closeModal() {
    modal.classList.remove('open');
    backBtn.classList.add("active");
  }
  
  
  /* --- 表示切り替え系 --- */
  // 動画のリセット
  function animationReset (v) {
    v.pause();
    v.currentTime = 0;
  }
  
  // 全縦動画の停止
  function allCardVideoStop () {
    cards.forEach(card => {
      const video = card.querySelector(".card-video");
      animationReset(video);
    });
  }
  
  //　動画の再生
  function playVideo (targetId) {
    const targetVideo = document.getElementById(targetId);
    targetVideo.play();
  }
  
  //タブバー切り替え処理
  function tabChange (tabName) {
    tabs.forEach(t => {
      const n = t.dataset.tab;
      const img = t.querySelector('img');
      if (n === tabName) {
        t.classList.add('active');
        img.src = `https://kkkkame0721.github.io/demoApp/icon/${n}_active.svg`;
      } else {
        t.classList.remove('active');
        img.src = `https://kkkkame0721.github.io/demoApp/icon/${n}.svg`;
      }
    });
  }
  
  //　スライドアニメーション
  function slideAnimation (targetPage) {
    // 準備：順番を調べる
    const tabOrder = ["home", "ticket", "collection", "scrollArea"];
    const currentIndex = tabOrder.indexOf(currentPage.id);
    const targetIndex = tabOrder.indexOf(targetPage.id);
    const isForward = targetIndex > currentIndex;
    
    // 準備：ターゲットを左外 or 右外に置く
    targetPage.classList.remove('left','right','active');
    targetPage.classList.add(isForward ? 'right' : 'left');
    // アニメーション完了後にクラスを消す
    currentPage.addEventListener('transitionend', () => {
      currentPage.classList.remove('left', 'right');
    }, { once: true });

    // force reflow（ブラウザに状態を認識させる）
    targetPage.offsetHeight;

    // 現在ページを出す
    currentPage.classList.remove('active');
    currentPage.classList.add(isForward ? 'left' : 'right');
    currentPage.offsetHeight;

    // ターゲットを中央に入れる
    targetPage.classList.remove('right','left');
    targetPage.classList.add('active');

    currentPage = targetPage;
  }
  
  /* --- 表示系まとめ --- */
  function displayUpdate (targetPage) {
    // モーダル、タイトルバーの表示・非表示切り替え
    const titleBar = document.getElementById("titleBar");
    
    if (targetPage.id === "scrollArea") {
      titleBar.classList.add("hidden");
      modal.classList.remove("open","hidden");
      backBtn.classList.add("active");
    } else {
      titleBar.classList.remove("hidden");
      modal.classList.remove("open");
      modal.classList.add("hidden");
      backBtn.classList.remove("active");
    }
    
    // ホーム下部画像の表示・非表示切り替え
    document.getElementById("homeBottom").style.display = (targetPage.id === "home") ? "block" : "none";
    
    // チケット詳細ページ、入場アニメーションのリセット
    document.getElementById("ticket-detail-panel").classList.remove("active");
    const ticketAnim = document.getElementById("ticketAnimation");
    ticketAnim.classList.remove("active");
    animationReset(ticketAnim);
  }

  /* --- ページ表示処理 --- */
  function showPage(tabName) {
    const targetPage = document.getElementById(tabName);
    
    // タブバー切り替え
    tabChange(tabName);
    
    // タイトルバー表示切り替え
    document.getElementById("pageTitle").textContent = targetPage.dataset.tabname;
    
    // 表示切り替え
    displayUpdate(targetPage);
    
    // タブスライドアニメーション処理
    // もし移動前後が同じページならアニメーションは無視する
    if (targetPage.id !== currentPage.id) slideAnimation(targetPage);
  }
  
  /* --- ロード画面を消す関数 --- */
  function hideLoad () {
    document.getElementById("load").classList.add("hidden");
  }
  /* --- 初期化 --- */
  function init () {
    /* --- 関数登録系 --- */
    
    // スクロールイベント登録
    scrollArea.addEventListener("scroll", updateVideoPlayback);
    
    // チケット詳細パネル関連
    const detailPanel = document.getElementById("ticket-detail-panel");
    const detailTitle = document.getElementById("detail-title");
    const detailBody = document.getElementById("detail-body");
    const ticketBackBtn = document.getElementById("detail-back-btn");

    // カードをクリックするとスライドイン
    document.querySelectorAll(".ticket-card").forEach((card, index) => {
      card.addEventListener("click", () => {

        const title = card.querySelector(".ticket-title").textContent;
        const date = card.querySelector(".ticket-date").textContent;
        let tmpPanel = "";
        if (index === 0) {
          tmpPanel = `
            <div class="dummy-detail">名古屋ミュージックホール"ダミー" 東2ホール</div>
            <button id="enter-btn" class="action-btn">入場する</button>
          `;
        } else if (index === 1) {
          tmpPanel = '<button class="action-btn inactive">まだ入場できません</button>';
        } else if (index === 2) {
          tmpPanel = `
            <img id="stub-image" src="https://kkkkame0721.github.io/demoApp/img/ticket_blank.jpg" style="width: 60%; display: block; margin: 0 auto; border-radius: 12px;">
            <div class="stub-actions">
              <button class="action-btn">撮影する</button>
              <button class="action-btn">写真・動画を選ぶ</button>
            </div>
          `;
        } else {
          tmpPanel = `
            <img src="https://kkkkame0721.github.io/demoApp/video/${card.dataset.thumbid}-thumbnail.jpg?ver=1.3" style="width: 60%; display: block; margin: 0 auto; border-radius: 12px;"/>
            <button class="action-btn" onclick=showPage('collection')>コレクションへ</button>
          `;
        }
        detailTitle.textContent = "チケット詳細";
        detailBody.innerHTML = `
          <div class="detail-section">
            <h3>${title}</h3>
            <p>${(index === 0) ? date+" 18:00 開場 / 19:00 開演":date}</p>
            ${tmpPanel}
        `;
        detailPanel.classList.add("active");

        if(index === 0) {
          // チケットアニメーション登録（押すと始まる）
          const ticketAnim = document.getElementById("ticketAnimation");
          ticketAnim.addEventListener("click", () => ticketAnim.play());
          ticketAnim.addEventListener("ended", () => {
            detailPanel.classList.remove("active");
            ticketAnim.classList.remove("active");
            animationReset(ticketAnim);
          });
          // 入場ボタン → 動画再生紐付け
          document.getElementById("enter-btn").addEventListener("click", () => {
            animationReset(ticketAnim);
            ticketAnim.classList.add("active");
          });
        }
      });
    });

    // チケット詳細パネルから戻る
    ticketBackBtn.addEventListener("click", () => {
      detailPanel.classList.remove("active");
    });
    
    // 動画クリックで再生
    scrollArea.addEventListener("click", e => {
      const target = e.target;
      if(target.classList.contains("card-video")) {
        if(target.paused) {
          target.play();
        } else {
          target.pause();
        }
      }
    });
    
    // タブアイコンに関数を登録
    tabs.forEach(tab => {
      const name = tab.dataset.tab;
      tab.addEventListener('click', () => {
        showPage(name);
      });
    });

    // ホーム下部画像 → チケットページへ
    document.getElementById("homeBottomToTicket").addEventListener("click", () => {
      const activeTabBtn = document.querySelector(".tab-btn.active");
      activeTabBtn.classList.remove("active");
      const preListTabBtn = document.getElementById("pre-list-btn");
      preListTabBtn.classList.add("active");
      
      const activeTab = document.querySelector(".ticket-list.active");
      activeTab.classList.remove("active");
      const preListTab = document.getElementById("pre-list");
      preListTab.classList.add("active");
      
      showPage("ticket");
    });

    // チケットタブ内のタブ切り替え
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelector(".tab-btn.active").classList.remove("active");
        btn.classList.add("active");

        document.querySelector(".ticket-list.active").classList.remove("active");
        document.getElementById(btn.dataset.target).classList.add("active");
      });
    });
    
    // 動画ページ ← 戻る
    backBtn.addEventListener('click', () => {
      showPage('collection');
    });
    
    /* --- デフォルトページ表示 --- */
    const p = document.getElementById(DEFAULT_PAGE);
    p.classList.add("active");
    showPage(DEFAULT_PAGE);
    
    // デバッグ用
    document.getElementById("modal-swipe-handle").addEventListener("click", openModal);
    
    // 0.4秒待ってからロード画面を隠す
    setTimeout(() => {
      hideLoad();
    }, 400);
  }
</script>
</body>
</html>
