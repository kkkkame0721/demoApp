<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>スワイプ＋詳細モーダル</title>
<style>

  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100vh;
    font-family: "Hiragino Maru Gothic ProN", "Hiragino Maru Gothic Pro","Rounded Mplus 1c", "Yu Gothic Rounded", "Noto Sans JP", sans-serif;
  }

  .page {
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transform: translateX(100%);
    transition: transform 0.4s ease;
    opacity: 0;
  }
  /* アクティブなページは中央に */
  .page.active {
    transform: translateX(0);
    opacity: 1;
  }
  .page.left {
    transform: translateX(-100%);
    opacity: 1;
  }
  .page.right {
    transform: translateX(100%);
    opacity: 1;
  }
  
  /* --- ✅ 上部タイトルバー --- */
  .title-bar {
    position: fixed;
    justify-content: center;
    top: 0;
    left: 0;
    width: 100%;
    height: 90px;
    background: #fff;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    padding: 0 1rem;
    box-sizing: border-box;
    z-index: 30;
  }
  .title-bar.hidden {
    display: none;
  }

  /* ハンバーガーメニューアイコン */
  .menu-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
      width: 24px;
    height: 24px;
    margin-right: 1rem;
    cursor: pointer;
  }

  /* タイトル文字 */
  .page-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: #333;
    margin: 0;
  }

  /* ページ内容はタイトルバーの下から始まるように */
  .page-content {
    padding-top: 90px;
    padding-bottom: 60px; /* 下のタブバー分 */
    box-sizing: border-box;
  }
  
  .page-content img{
    width: 100%;
  }
  .page-content #homeBottom {
    position: fixed;
    bottom: 70px;
    left: 0px;
    z-index: 40;
  }
  .page-content #homeBottomToTicket {
    cursor: pointer;
  }

  .card {
    position: relative;
    height: 100vh;
    width: 100%;
    scroll-snap-align: start;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2rem;
    transition: transform 0.4s ease, opacity 0.4s ease;
  }

  .card:nth-child(odd) { background: #ff4b5c; }
  .card:nth-child(even) { background: #2b2e4a; }

  .card:not(.active) {
    transform: scale(0.95);
    opacity: 0.7;
  }

  /* モーダルの基本構造 */
  .modal {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100%;
    height: 100%;
    background: white;
    color: #333;
    transition: right 0.4s ease;
    z-index: 10;
    box-shadow: -4px 0 10px rgba(0,0,0,0.3);
    overflow-y: auto;
  }

  .modal.open {
    right: 0;
  }

  .modal-header {
    padding: 1rem;
    background: #222;
    color: white;
    font-size: 1.2rem;
  }

  .modal-content {
    padding: 1.5rem;
  }

  .close-btn {
    color: #fff;
    float: right;
    font-size: 1.2rem;
    cursor: pointer;
  }

  .info {
    position: absolute;
    bottom: calc(60px + env(safe-area-inset-bottom));
    left: calc(16px + env(safe-area-inset-left));
    font-size: 1.1rem;
    text-shadow: 0 0 8px rgba(0,0,0,0.6);
  }
  
  /* コレクションページ */
  .collection-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 4px;
    padding: 4px;
  }
  .collection-grid img {
    width: 100%;
    border-radius: 4px;
    cursor: pointer;
  }

  /* 戻るボタン */
  .back-btn {
    position: fixed;
    top: 16px;
    left: 16px;
    background: rgba(0,0,0,0);
    color: white;
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    font-size: 1.2rem;
    z-index: 20;
    cursor: pointer;
    display: none;
  }
  
  .back-btn.active {
    display: block;
  } 
  
  /* --- ✅ ボトムタブバー --- */
  .tab-bar {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 60px;
    background: #fff;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    z-index: 20;
    padding-top: 0.2rem;
  }

  .tab {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 33.3%;
    font-size: 0.7rem;
    color: #757575;
    cursor: pointer;
  }

  .tab img {
    width: 22px;
    height: 22px;
    margin-bottom: 2px;
  }

  .tab.active {
    font-weight: bold;
  }

  .tab.active span {
    background: linear-gradient(to right, #FF54AF, #FF9A0B);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
</style>
</head>
<body>
  <div class="title-bar" id="titleBar">
    <img src="https://kkkkame0721.github.io/demoApp/img/menu.svg" alt="menu" class="menu-icon" />
    <h1 class="page-title" id="pageTitle">タイトルバー</h1>
  </div>
  
  <div class="page active" id="home" data-tabname="ホーム">
    <div class="page-content">
      <img src="https://kkkkame0721.github.io/demoApp/img/home_content.svg?ver=1.1" id="homeContent" />
      <div id="homeBottom">
        <img src="https://kkkkame0721.github.io/demoApp/img/home_content_bottom_1.svg" id="homeBottomToTicket" />
        <img src="https://kkkkame0721.github.io/demoApp/img/home_content_bottom_2.svg" />
      </div>
    </div>
  </div>
  
  <div class="page" id="ticket" data-tabname="チケット管理">
    <div class="page-content">
      <img src="https://kkkkame0721.github.io/demoApp/img/ticket_content.svg" id="ticketContent" />
    </div>
  </div>
  
  <div class="page" id="collection" data-tabname="コレクション">
    <div class="page-content">
      <div class="collection-grid" id="collectionGrid">
      </div>
    </div>
  </div>
  
  <div class="page" id="scrollArea">
    <button class="back-btn" id="backBtn">←</button>
    <!-- 詳細モーダル -->
    <div class="modal" id="modal">
      <div class="modal-header">
        詳細ページ
        <span class="close-btn" id="closeModal">✕</span>
      </div>
      <div class="modal-content" id="modalContent"></div>
    </div>
  </div>


  <!-- ✅ ボトムバー -->
  <div class="tab-bar" id="tabBar">
    <div class="tab active" data-tab="home">
      <img src="https://kkkkame0721.github.io/demoApp/icon/home.svg" alt="ホーム">
      <span>ホーム</span>
    </div>
    <div class="tab" data-tab="ticket">
      <img src="https://kkkkame0721.github.io/demoApp/icon/ticket.svg" alt="チケット">
      <span>チケット</span>
    </div>
    <div class="tab" data-tab="collection">
      <img src="https://kkkkame0721.github.io/demoApp/icon/collection_active.svg" alt="コレクション">
      <span>コレクション</span>
    </div>
  </div>

<script>
  const pages = document.querySelectorAll('.page');
  const scrollArea = document.getElementById('scrollArea');
  const modal = document.getElementById('modal');
  const modalContent = document.getElementById('modalContent');
  const closeBtn = document.getElementById('closeModal');
  const tabs = document.querySelectorAll('.tab');
  const collectionGrid = document.getElementById('collectionGrid');
  const backBtn = document.getElementById('backBtn');
  let cards = [];
  let currentPage = document.getElementById("home");

  // --- JSONデータ取得 ---
  fetch('https://kkkkame0721.github.io/demoApp/data.json?ver='+Date.now())
    .then(res => res.json())
    .then(data => {
      data.forEach(item => {
        const card = document.createElement('div');
        card.classList.add('card');
        card.innerHTML = `
          <div class="info">
            ${item.title}
            <br>
            ${item.date}
          </div>
        `;
        scrollArea.appendChild(card);
        const thumb = document.createElement('img');
        thumb.src = item.thumbnail;
        collectionGrid.appendChild(thumb);
      });
      cards = document.querySelectorAll('.card');
    });

  // --- 縦スクロールのアニメーション制御 ---
  scrollArea.addEventListener('scroll', () => {
    const scrollPos = scrollArea.scrollTop;
    const height = window.innerHeight;
    cards.forEach((card, index) => {
      const offset = Math.abs(scrollPos - index * height);
      const progress = Math.min(offset / height, 1);
      card.style.transform = `scale(${1 - progress * 0.05})`;
      card.style.opacity = `${1 - progress * 0.3}`;
      card.classList.toggle('active', Math.round(scrollPos / height) === index);
      card.addEventListener("click", openModal);
    });
  });

  // --- スワイプ検知（横方向） ---
  let startX = 0;
  let endX = 0;

  scrollArea.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX;
  });

  scrollArea.addEventListener('touchend', e => {
    endX = e.changedTouches[0].clientX;
    const diff = endX - startX;

    // 左スワイプ（→ 詳細モーダル開く）
    if (diff < -80) {
      openModal();
    }
  });
  
  // モーダル内スワイプで閉じる
  let modalStartX = 0;
  modal.addEventListener('touchstart', e => modalStartX = e.touches[0].clientX);
  modal.addEventListener('touchend', e => {
    const modalDiff = e.changedTouches[0].clientX - modalStartX;
    if (modalDiff > 80) closeModalFn();
  });

  // ボタンで閉じる
  closeBtn.addEventListener('click', closeModalFn);

  function openModal() {
    const activeCard = document.querySelector('.card.active');
    const index = Array.from(cards).indexOf(activeCard);
    const data = index >= 0 ? cards[index].textContent.trim() : '詳細情報';
    modalContent.innerHTML = `<h2>${data}</h2><p>ここに動画の詳細情報が入ります。</p>`;
    modal.classList.add('open');
    backBtn.classList.remove("active");
  }

  function closeModalFn() {
    modal.classList.remove('open');
    backBtn.classList.add("active");
  }

  // ▼ タブ切り替え処理（最重要）
  function showPage(tabName) {
    //タブバー切り替え
    tabs.forEach(t => {
      const n = t.dataset.tab;
      const img = t.querySelector('img');
      if (n === tabName) {
        t.classList.add('active');
        img.src = `https://kkkkame0721.github.io/demoApp/icon/${n}_active.svg`;
      } else {
        t.classList.remove('active');
        img.src = `https://kkkkame0721.github.io/demoApp/icon/${n}.svg`;
      }
    });
    //ページ切り替え
    const targetPage = document.getElementById(tabName);
    const targetPageName = targetPage.dataset.tabname;
    document.getElementById("pageTitle").textContent = targetPageName;
    if (targetPage.id === currentPage.id) return;
    
    // タイトルバーの表示 / 非表示切り替え
    const titleBar = document.getElementById("titleBar");
    if (targetPage.id === "scrollArea") {
      titleBar.classList.add("hidden");
    } else {
      titleBar.classList.remove("hidden");
    }

    //順番を調べる
    const tabOrder = ["home", "ticket", "collection", "scrollArea"];
    const currentIndex = tabOrder.indexOf(currentPage.id);
    const targetIndex = tabOrder.indexOf(targetPage.id);
    const isForward = targetIndex > currentIndex;
    
    // 準備：ターゲットを左外 or 右外に置く
    targetPage.classList.remove('left','right','active');
    targetPage.classList.add(isForward ? 'right' : 'left');
    // ✅ アニメーション完了後にクラスを消す
    currentPage.addEventListener('transitionend', () => {
      currentPage.classList.remove('left', 'right');
    }, { once: true });

    // force reflow（ブラウザに状態を認識させる）
    targetPage.offsetHeight;

    // 現在ページを出す
    currentPage.classList.remove('active');
    currentPage.classList.add(isForward ? 'left' : 'right');
    currentPage.offsetHeight;

    // ターゲットを中央に入れる
    targetPage.classList.remove('right','left');
    targetPage.classList.add('active');

    currentPage = targetPage;
  }
  
  // --- ✅ タブ切り替え ---
  tabs.forEach(tab => {
    const name = tab.dataset.tab;
    tab.addEventListener('click', () => {
      showPage(name);
    });
  });
  
  //ホーム下部 → チケットへ
  document.getElementById("homeBottomToTicket").addEventListener("click", () => showPage("ticket"));
  
  // ▼ コレクション → 動画ページへ
  collectionGrid.addEventListener('click', e => {
    if (e.target.tagName === 'IMG') {
      showPage('scrollArea');
      backBtn.classList.add("active");
    }
  });
  // ▼ 動画ページ ← 戻る
  backBtn.addEventListener('click', () => {
    showPage('collection');
    backBtn.classList.remove("active");
  });
  
  document.addEventListener('DOMContentLoaded', () => {
    showPage("home");
  });
</script>
</body>
</html>
